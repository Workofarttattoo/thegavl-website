<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The GAVL Court Session • Evidence Collection</title>

    <style>
        /* Copyright (c) 2025 Joshua Hendricks Cole (DBA: Corporation of Light). All Rights Reserved. PATENT PENDING. */

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Courier+Prime:wght@400;700&display=swap');

        :root {
            --gavl-navy: #0A1628;
            --gavl-blue: #1E40AF;
            --gavl-gold: #D4AF37;
            --gavl-white: #FFFFFF;
            --gavl-gray: #F3F4F6;
            --gavl-text: #1F2937;
            --gavl-border: #E5E7EB;
            --gavl-green: #059669;
            --dimension-glow: #A855F7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gavl-navy);
            color: var(--gavl-white);
            min-height: 100vh;
            overflow: hidden;
        }

        /* Evidence Collection Wizard */
        .evidence-wizard {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            background: var(--gavl-navy);
        }

        .evidence-wizard.hidden {
            display: none;
        }

        .wizard-container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .wizard-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .wizard-header h1 {
            font-size: 3rem;
            color: var(--gavl-gold);
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
            text-shadow: 0 0 40px rgba(212, 175, 55, 0.5);
        }

        .wizard-header p {
            font-size: 1.2rem;
            opacity: 0.8;
        }

        /* Progress indicator */
        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3rem;
            padding: 0 2rem;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
        }

        .progress-step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            z-index: -1;
        }

        .progress-step:last-child::after {
            display: none;
        }

        .progress-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
        }

        .progress-step.active .progress-circle {
            background: var(--gavl-blue);
            border-color: var(--gavl-blue);
            box-shadow: 0 0 20px var(--gavl-blue);
        }

        .progress-step.completed .progress-circle {
            background: var(--gavl-gold);
            border-color: var(--gavl-gold);
        }

        .progress-label {
            font-size: 0.85rem;
            opacity: 0.7;
            text-align: center;
        }

        /* Evidence cards */
        .evidence-card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            padding: 3rem;
            color: var(--gavl-text);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            margin-bottom: 2rem;
        }

        .evidence-card h2 {
            font-size: 2rem;
            color: var(--gavl-navy);
            margin-bottom: 1rem;
        }

        .evidence-card p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            color: var(--gavl-text);
        }

        /* Recording interface */
        .recording-interface {
            text-align: center;
            padding: 2rem;
        }

        .record-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gavl-blue), var(--gavl-gold));
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2rem auto;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(30, 64, 175, 0.4);
        }

        .record-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 50px rgba(30, 64, 175, 0.6);
        }

        .record-button.recording {
            animation: pulse-record 1.5s ease-in-out infinite;
            background: linear-gradient(135deg, #DC2626, #EF4444);
        }

        @keyframes pulse-record {
            0%, 100% { transform: scale(1); box-shadow: 0 10px 40px rgba(220, 38, 38, 0.4); }
            50% { transform: scale(1.1); box-shadow: 0 15px 60px rgba(220, 38, 38, 0.8); }
        }

        .record-icon {
            font-size: 3rem;
        }

        .recording-status {
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 1rem;
            color: var(--gavl-blue);
        }

        .recording-status.active {
            color: #DC2626;
        }

        /* Transcription display */
        .transcription-box {
            background: var(--gavl-gray);
            border: 2px solid var(--gavl-border);
            border-radius: 15px;
            padding: 2rem;
            min-height: 200px;
            margin: 2rem 0;
            font-family: 'Courier Prime', monospace;
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--gavl-text);
        }

        .transcription-box.empty {
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9CA3AF;
            font-style: italic;
        }

        /* Evidence list */
        .evidence-list {
            margin: 2rem 0;
        }

        .evidence-item {
            background: var(--gavl-gray);
            border-left: 4px solid var(--gavl-blue);
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .evidence-item:hover {
            border-left-color: var(--gavl-gold);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .evidence-title {
            font-weight: 700;
            color: var(--gavl-navy);
            margin-bottom: 0.5rem;
        }

        .evidence-content {
            font-size: 0.95rem;
            color: var(--gavl-text);
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
        }

        button.primary {
            padding: 1rem 2.5rem;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: var(--gavl-blue);
            color: var(--gavl-white);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.4);
        }

        button.primary:hover {
            background: #1E3A8A;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 64, 175, 0.5);
        }

        button.secondary {
            padding: 1rem 2.5rem;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: transparent;
            color: var(--gavl-white);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button.secondary:hover {
            border-color: var(--gavl-white);
            background: rgba(255, 255, 255, 0.1);
        }

        /* Dimensional Verdict Screen */
        .verdict-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000000;
            z-index: 200;
            overflow: hidden;
        }

        .verdict-screen.active {
            display: block;
        }

        /* Dimensional grid effect */
        .dimensional-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(0deg, transparent 24%, rgba(168, 85, 247, 0.1) 25%, rgba(168, 85, 247, 0.1) 26%, transparent 27%, transparent 74%, rgba(168, 85, 247, 0.1) 75%, rgba(168, 85, 247, 0.1) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(168, 85, 247, 0.1) 25%, rgba(168, 85, 247, 0.1) 26%, transparent 27%, transparent 74%, rgba(168, 85, 247, 0.1) 75%, rgba(168, 85, 247, 0.1) 76%, transparent 77%, transparent);
            background-size: 50px 50px;
            animation: grid-scroll 20s linear infinite;
            opacity: 0.3;
        }

        @keyframes grid-scroll {
            0% { transform: translateY(0); }
            100% { transform: translateY(50px); }
        }

        /* Verdict text container */
        .verdict-text-container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 4rem 2rem;
            height: 100vh;
            overflow-y: auto;
        }

        .verdict-header {
            text-align: center;
            margin-bottom: 3rem;
            animation: fade-in-glow 1s ease-out;
        }

        @keyframes fade-in-glow {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .verdict-header h1 {
            font-size: 3rem;
            color: var(--gavl-gold);
            text-shadow: 0 0 40px var(--dimension-glow), 0 0 80px var(--dimension-glow);
            letter-spacing: 0.3em;
            margin-bottom: 1rem;
        }

        .verdict-header .case-id {
            font-family: 'Courier Prime', monospace;
            color: var(--dimension-glow);
            font-size: 1.2rem;
            letter-spacing: 0.2em;
        }

        /* Scrolling verdict text (typewriter from another dimension) */
        .verdict-content {
            font-family: 'Courier Prime', monospace;
            font-size: 1.3rem;
            line-height: 2;
            color: #E0E0E0;
            text-shadow: 0 0 10px rgba(168, 85, 247, 0.5);
            white-space: pre-wrap;
            margin-bottom: 2rem;
        }

        .typing-cursor {
            display: inline-block;
            width: 3px;
            height: 1.2em;
            background: var(--dimension-glow);
            margin-left: 2px;
            animation: blink-cursor 0.8s infinite;
            box-shadow: 0 0 15px var(--dimension-glow);
        }

        @keyframes blink-cursor {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        /* Dimensional portal effect behind text */
        .dimensional-portal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.2) 0%, transparent 70%);
            filter: blur(60px);
            animation: portal-pulse 4s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes portal-pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.3; }
            50% { transform: translate(-50%, -50%) scale(1.5); opacity: 0.6; }
        }

        /* Verdict complete indicator */
        .verdict-complete {
            text-align: center;
            margin-top: 3rem;
            padding: 2rem;
            border-top: 2px solid var(--dimension-glow);
            animation: fade-in-glow 1s ease-out;
        }

        .verdict-complete h3 {
            font-size: 2rem;
            color: var(--gavl-gold);
            margin-bottom: 1rem;
            text-shadow: 0 0 20px var(--dimension-glow);
        }

        /* Hidden utility */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Evidence Collection Wizard -->
    <div class="evidence-wizard" id="evidence-wizard">
        <div class="wizard-container">
            <div class="wizard-header">
                <h1>THE GAVL</h1>
                <p>Evidence Collection Protocol</p>
            </div>

            <!-- Progress Bar -->
            <div class="wizard-progress">
                <div class="progress-step active" data-step="0">
                    <div class="progress-circle">1</div>
                    <div class="progress-label">Case Info</div>
                </div>
                <div class="progress-step" data-step="1">
                    <div class="progress-circle">2</div>
                    <div class="progress-label">Evidence</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="progress-circle">3</div>
                    <div class="progress-label">Review</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="progress-circle">4</div>
                    <div class="progress-label">Submit</div>
                </div>
            </div>

            <!-- Step 0: Case Information -->
            <div class="evidence-card" id="step-0">
                <h2>Case Information</h2>
                <p>Provide basic information about the case before collecting evidence.</p>

                <form id="case-info-form">
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Case Title</label>
                        <input type="text" required style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;">
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Case Type</label>
                        <select required style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;">
                            <option value="">Select type...</option>
                            <option value="criminal">Criminal</option>
                            <option value="civil">Civil</option>
                            <option value="family">Family Law</option>
                            <option value="commercial">Commercial</option>
                            <option value="constitutional">Constitutional</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Brief Description</label>
                        <textarea rows="4" required style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;"></textarea>
                    </div>
                </form>

                <div class="button-group">
                    <button class="primary" onclick="nextStep()">Continue →</button>
                </div>
            </div>

            <!-- Step 1: Evidence Collection -->
            <div class="evidence-card hidden" id="step-1">
                <h2>Evidence Collection</h2>
                <p>Import evidence from multiple sources: voice recording, document upload, or PACER case data.</p>

                <!-- Evidence Source Tabs -->
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid #E5E7EB;">
                    <button onclick="switchTab('voice')" id="tab-voice" class="evidence-tab active" style="padding: 1rem 1.5rem; background: none; border: none; font-weight: 600; cursor: pointer; border-bottom: 3px solid var(--gavl-gold); color: var(--gavl-navy);">
                        🎤 Voice
                    </button>
                    <button onclick="switchTab('upload')" id="tab-upload" class="evidence-tab" style="padding: 1rem 1.5rem; background: none; border: none; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; color: #9CA3AF;">
                        📄 Upload
                    </button>
                    <button onclick="switchTab('pacer')" id="tab-pacer" class="evidence-tab" style="padding: 1rem 1.5rem; background: none; border: none; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; color: #9CA3AF;">
                        ⚖️ PACER
                    </button>
                    <button onclick="switchTab('manual')" id="tab-manual" class="evidence-tab" style="padding: 1rem 1.5rem; background: none; border: none; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; color: #9CA3AF;">
                        ✍️ Manual
                    </button>
                </div>

                <!-- Voice Tab -->
                <div id="evidence-voice" class="evidence-tab-content">
                    <div class="recording-interface">
                        <button class="record-button" id="record-button" onclick="toggleRecording()">
                            <span class="record-icon" id="record-icon">🎤</span>
                        </button>
                        <div class="recording-status" id="recording-status">Click to start recording</div>
                    </div>

                    <div class="transcription-box" id="transcription-box">
                        <p style="color: #9CA3AF; font-style: italic;">Your transcription will appear here...</p>
                    </div>

                    <div class="button-group">
                        <button class="secondary" onclick="addEvidence('voice')">Add This Evidence</button>
                    </div>
                </div>

                <!-- Upload Tab -->
                <div id="evidence-upload" class="evidence-tab-content" style="display: none;">
                    <div style="border: 2px dashed #D1D5DB; border-radius: 12px; padding: 3rem; text-align: center; background: #F9FAFB;">
                        <input type="file" id="file-upload" accept=".pdf,.docx,.doc,.txt" multiple style="display: none;" onchange="handleFileUpload(event)">
                        <button onclick="document.getElementById('file-upload').click()" style="background: var(--gavl-blue); color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                            📁 Choose Files
                        </button>
                        <p style="margin-top: 1rem; color: #6B7280; font-size: 0.9rem;">
                            Upload PDF, DOCX, or TXT files<br>
                            <span style="font-size: 0.8rem; opacity: 0.7;">Maximum 10MB per file</span>
                        </p>
                    </div>

                    <div id="uploaded-files" style="margin-top: 2rem;">
                        <!-- Uploaded files list will appear here -->
                    </div>
                </div>

                <!-- PACER Tab -->
                <div id="evidence-pacer" class="evidence-tab-content" style="display: none;">
                    <div style="background: #F9FAFB; border-radius: 12px; padding: 2rem;">
                        <h3 style="color: var(--gavl-navy); margin-bottom: 1rem;">Import from PACER</h3>
                        <p style="margin-bottom: 1.5rem; color: #6B7280; font-size: 0.9rem;">
                            Enter a PACER case number to automatically import case data and docket entries.
                        </p>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gavl-navy);">Court District</label>
                            <select id="pacer-court" style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;">
                                <option value="">Select court...</option>
                                <option value="cacd">C.D. California</option>
                                <option value="nysd">S.D. New York</option>
                                <option value="txnd">N.D. Texas</option>
                                <option value="flsd">S.D. Florida</option>
                                <option value="ilnd">N.D. Illinois</option>
                                <option value="other">Other (Manual Entry)</option>
                            </select>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gavl-navy);">Case Number</label>
                            <input type="text" id="pacer-case-number" placeholder="e.g., 1:21-cv-12345" style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;">
                        </div>

                        <div class="button-group">
                            <button class="primary" onclick="importFromPACER()">🔍 Import Case Data</button>
                        </div>

                        <div id="pacer-results" style="margin-top: 2rem;">
                            <!-- PACER import results will appear here -->
                        </div>
                    </div>
                </div>

                <!-- Manual Tab -->
                <div id="evidence-manual" class="evidence-tab-content" style="display: none;">
                    <div style="background: #F9FAFB; border-radius: 12px; padding: 2rem;">
                        <h3 style="color: var(--gavl-navy); margin-bottom: 1rem;">Manual Evidence Entry</h3>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gavl-navy);">Evidence Title</label>
                            <input type="text" id="manual-title" placeholder="e.g., Witness Statement, Physical Evidence" style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;">
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--gavl-navy);">Evidence Description</label>
                            <textarea id="manual-description" rows="6" placeholder="Provide detailed description of the evidence..." style="width: 100%; padding: 0.75rem; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1rem;"></textarea>
                        </div>

                        <div class="button-group">
                            <button class="secondary" onclick="addEvidence('manual')">Add This Evidence</button>
                        </div>
                    </div>
                </div>

                <h3 style="margin-top: 3rem; margin-bottom: 1rem; color: var(--gavl-navy);">Collected Evidence</h3>
                <div class="evidence-list" id="evidence-list">
                    <p style="color: #9CA3AF; font-style: italic;">No evidence collected yet.</p>
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">← Back</button>
                    <button class="primary" onclick="nextStep()">Continue →</button>
                </div>
            </div>

            <!-- Step 2: Review -->
            <div class="evidence-card hidden" id="step-2">
                <h2>Review Evidence</h2>
                <p>Review all collected evidence before submitting to The GAVL for analysis.</p>

                <div id="review-list" style="margin: 2rem 0;">
                    <!-- Evidence will be populated here -->
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">← Back</button>
                    <button class="primary" onclick="nextStep()">Continue →</button>
                </div>
            </div>

            <!-- Step 3: Submit -->
            <div class="evidence-card hidden" id="step-3">
                <h2>Submit to The GAVL</h2>
                <p>Your case and evidence are ready for analysis. The algorithmic court will now deliberate.</p>

                <div style="background: var(--gavl-gray); border-radius: 15px; padding: 2rem; margin: 2rem 0;">
                    <h3 style="color: var(--gavl-navy); margin-bottom: 1rem;">⚖️ Case Summary</h3>
                    <p style="margin-bottom: 0.5rem;"><strong>Case:</strong> <span id="summary-title">—</span></p>
                    <p style="margin-bottom: 0.5rem;"><strong>Type:</strong> <span id="summary-type">—</span></p>
                    <p style="margin-bottom: 0.5rem;"><strong>Evidence Items:</strong> <span id="summary-count">0</span></p>
                </div>

                <div class="button-group">
                    <button class="secondary" onclick="prevStep()">← Back</button>
                    <button class="primary" onclick="enterCourt()">Enter Court →</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dimensional Verdict Screen -->
    <div class="verdict-screen" id="verdict-screen">
        <div class="dimensional-grid"></div>
        <div class="dimensional-portal"></div>

        <div class="verdict-text-container">
            <div class="verdict-header">
                <h1>VERDICT</h1>
                <div class="case-id">CASE ID: <span id="case-id">GAVL-2025-001</span></div>
            </div>

            <div class="verdict-content" id="verdict-content">
                <!-- Verdict text will be typed here from another dimension -->
            </div>

            <div class="verdict-complete hidden" id="verdict-complete">
                <h3>✓ Analysis Complete</h3>
                <button class="primary" onclick="returnToDashboard()" style="margin-top: 1rem;">Return to Dashboard</button>
            </div>
        </div>
    </div>

    <!-- GAVL API Connector -->
    <script src="gavl_api_connector.js"></script>

    <script>
        /* Copyright (c) 2025 Joshua Hendricks Cole (DBA: Corporation of Light). All Rights Reserved. PATENT PENDING. */

        // State management
        let currentStep = 0;
        let isRecording = false;
        let currentTranscription = "";
        let evidenceList = [];
        let verdictResult = null; // Store real verdict result

        // Simulated Whisper transcription (in production, this would call actual Whisper API)
        let simulatedTranscriptionText = "This is a simulated transcription. In production, this would use OpenAI Whisper to transcribe audio in real-time. The evidence presented shows clear documentation of all relevant facts.";
        let transcriptionIndex = 0;

        // Progress management
        function updateProgress() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }

        function nextStep() {
            if (currentStep < 3) {
                document.getElementById(`step-${currentStep}`).classList.add('hidden');
                currentStep++;
                document.getElementById(`step-${currentStep}`).classList.remove('hidden');
                updateProgress();

                if (currentStep === 2) {
                    populateReview();
                } else if (currentStep === 3) {
                    populateSummary();
                }
            }
        }

        function prevStep() {
            if (currentStep > 0) {
                document.getElementById(`step-${currentStep}`).classList.add('hidden');
                currentStep--;
                document.getElementById(`step-${currentStep}`).classList.remove('hidden');
                updateProgress();
            }
        }

        // Recording functions (simulated - in production would use Web Audio API + Whisper)
        function toggleRecording() {
            const button = document.getElementById('record-button');
            const icon = document.getElementById('record-icon');
            const status = document.getElementById('recording-status');
            const transcriptionBox = document.getElementById('transcription-box');

            isRecording = !isRecording;

            if (isRecording) {
                button.classList.add('recording');
                icon.textContent = '⏹️';
                status.textContent = 'Recording... Click to stop';
                status.classList.add('active');

                // Simulate transcription
                transcriptionBox.innerHTML = '';
                transcriptionIndex = 0;
                startSimulatedTranscription();
            } else {
                button.classList.remove('recording');
                icon.textContent = '🎤';
                status.textContent = 'Click to start recording';
                status.classList.remove('active');
                currentTranscription = transcriptionBox.textContent;
            }
        }

        function startSimulatedTranscription() {
            if (!isRecording) return;

            const transcriptionBox = document.getElementById('transcription-box');

            if (transcriptionIndex < simulatedTranscriptionText.length) {
                transcriptionBox.textContent += simulatedTranscriptionText[transcriptionIndex];
                transcriptionIndex++;

                // Auto-scroll
                transcriptionBox.scrollTop = transcriptionBox.scrollHeight;

                setTimeout(startSimulatedTranscription, 50);
            }
        }

        function addEvidence(type = 'voice') {
            let evidenceText = '';
            let evidenceTitle = '';

            if (type === 'voice') {
                const transcriptionBox = document.getElementById('transcription-box');
                const text = transcriptionBox.textContent;

                if (!text || text.trim().length === 0 || text.includes('Your transcription will appear here')) {
                    alert('Please record some evidence first.');
                    return;
                }

                evidenceText = text;
                evidenceTitle = 'Voice Recording';

                // Clear transcription
                transcriptionBox.innerHTML = '<p style="color: #9CA3AF; font-style: italic;">Your transcription will appear here...</p>';
                currentTranscription = "";

            } else if (type === 'manual') {
                const title = document.getElementById('manual-title').value.trim();
                const description = document.getElementById('manual-description').value.trim();

                if (!title || !description) {
                    alert('Please fill in both title and description.');
                    return;
                }

                evidenceTitle = title;
                evidenceText = description;

                // Clear form
                document.getElementById('manual-title').value = '';
                document.getElementById('manual-description').value = '';
            }

            evidenceList.push({
                id: Date.now(),
                title: evidenceTitle,
                text: evidenceText,
                type: type,
                timestamp: new Date().toISOString()
            });

            updateEvidenceList();
        }

        // Tab switching function
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.evidence-tab').forEach(tab => {
                tab.classList.remove('active');
                tab.style.borderBottom = '3px solid transparent';
                tab.style.color = '#9CA3AF';
            });

            const activeTab = document.getElementById(`tab-${tabName}`);
            activeTab.classList.add('active');
            activeTab.style.borderBottom = '3px solid var(--gavl-gold)';
            activeTab.style.color = 'var(--gavl-navy)';

            // Update tab content
            document.querySelectorAll('.evidence-tab-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`evidence-${tabName}`).style.display = 'block';
        }

        // File upload handler
        async function handleFileUpload(event) {
            const files = event.target.files;
            const uploadedFilesDiv = document.getElementById('uploaded-files');

            if (files.length === 0) return;

            uploadedFilesDiv.innerHTML = '<h4 style="color: var(--gavl-navy); margin-bottom: 1rem;">📎 Uploaded Files</h4>';

            for (const file of files) {
                // Check file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`File "${file.name}" is too large. Maximum size is 10MB.`);
                    continue;
                }

                // Read file content
                const text = await readFileContent(file);

                // Add to evidence list
                evidenceList.push({
                    id: Date.now() + Math.random(),
                    title: `Document: ${file.name}`,
                    text: text.substring(0, 5000), // Limit to 5000 chars for display
                    type: 'upload',
                    fileName: file.name,
                    fileSize: file.size,
                    timestamp: new Date().toISOString()
                });

                // Show file in uploaded list
                uploadedFilesDiv.innerHTML += `
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border: 1px solid #E5E7EB;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong style="color: var(--gavl-navy);">${file.name}</strong>
                                <p style="font-size: 0.85rem; color: #6B7280; margin-top: 0.25rem;">
                                    ${(file.size / 1024).toFixed(1)} KB • ${text.length} characters extracted
                                </p>
                            </div>
                            <span style="color: var(--gavl-green); font-size: 1.5rem;">✓</span>
                        </div>
                    </div>
                `;
            }

            updateEvidenceList();

            // Show success message
            alert(`Successfully imported ${files.length} file(s) as evidence!`);
        }

        // Read file content (simplified - in production would use proper PDF/DOCX parsers)
        function readFileContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    let text = e.target.result;

                    // For text files, use as-is
                    // For PDF/DOCX, this would need proper parsing
                    // Simplified: just extract whatever text we can
                    resolve(text || `Content from ${file.name} (full parsing requires backend)`);
                };

                reader.onerror = reject;
                reader.readAsText(file);
            });
        }

        // PACER import function
        async function importFromPACER() {
            const court = document.getElementById('pacer-court').value;
            const caseNumber = document.getElementById('pacer-case-number').value.trim();
            const resultsDiv = document.getElementById('pacer-results');

            if (!court || !caseNumber) {
                alert('Please select a court and enter a case number.');
                return;
            }

            // Show loading
            resultsDiv.innerHTML = `
                <div style="background: white; padding: 2rem; border-radius: 12px; text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">⏳</div>
                    <p style="color: var(--gavl-navy); font-weight: 600;">Connecting to PACER...</p>
                    <p style="color: #6B7280; font-size: 0.9rem; margin-top: 0.5rem;">Fetching case ${caseNumber} from ${court.toUpperCase()}</p>
                </div>
            `;

            // Simulate PACER API call (in production, this would call actual PACER API)
            setTimeout(() => {
                // Simulated case data
                const caseData = {
                    caseNumber: caseNumber,
                    court: court.toUpperCase(),
                    title: 'Sample v. Example Corp.',
                    filed: '2024-01-15',
                    status: 'Active',
                    docketEntries: [
                        { date: '2024-01-15', entry: 'Complaint filed', document: 'Complaint.pdf' },
                        { date: '2024-02-01', entry: 'Answer to Complaint', document: 'Answer.pdf' },
                        { date: '2024-03-10', entry: 'Motion for Summary Judgment', document: 'MSJ.pdf' },
                        { date: '2024-04-05', entry: 'Opposition to Motion', document: 'Opposition.pdf' }
                    ]
                };

                // Display results
                resultsDiv.innerHTML = `
                    <div style="background: white; padding: 2rem; border-radius: 12px;">
                        <h4 style="color: var(--gavl-navy); margin-bottom: 1rem;">✅ Case Found</h4>
                        <div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid #E5E7EB;">
                            <p><strong>Case:</strong> ${caseData.title}</p>
                            <p><strong>Number:</strong> ${caseData.caseNumber}</p>
                            <p><strong>Court:</strong> ${caseData.court}</p>
                            <p><strong>Filed:</strong> ${caseData.filed}</p>
                            <p><strong>Status:</strong> <span style="color: var(--gavl-green);">${caseData.status}</span></p>
                        </div>

                        <h5 style="color: var(--gavl-navy); margin-bottom: 1rem;">Docket Entries (${caseData.docketEntries.length})</h5>
                        ${caseData.docketEntries.map(entry => `
                            <div style="padding: 0.75rem; background: #F9FAFB; border-radius: 6px; margin-bottom: 0.5rem;">
                                <div style="display: flex; justify-content: space-between;">
                                    <strong style="color: var(--gavl-navy);">${entry.date}</strong>
                                    <span style="color: #6B7280; font-size: 0.9rem;">${entry.document}</span>
                                </div>
                                <p style="color: #6B7280; font-size: 0.9rem; margin-top: 0.25rem;">${entry.entry}</p>
                            </div>
                        `).join('')}

                        <div class="button-group" style="margin-top: 1.5rem;">
                            <button class="primary" onclick="importPACERData()">📥 Import All Data as Evidence</button>
                        </div>
                    </div>
                `;
            }, 2000);
        }

        // Import PACER data as evidence
        function importPACERData() {
            const court = document.getElementById('pacer-court').value;
            const caseNumber = document.getElementById('pacer-case-number').value;

            // Add PACER data as structured evidence
            evidenceList.push({
                id: Date.now(),
                title: `PACER Import: ${caseNumber}`,
                text: `Full case data imported from PACER including docket entries, filings, and case metadata.`,
                type: 'pacer',
                court: court,
                caseNumber: caseNumber,
                timestamp: new Date().toISOString()
            });

            updateEvidenceList();
            alert('PACER case data successfully imported as evidence!');

            // Switch back to main evidence list
            switchTab('voice');
        }

        function updateEvidenceList() {
            const listContainer = document.getElementById('evidence-list');

            if (evidenceList.length === 0) {
                listContainer.innerHTML = '<p style="color: #9CA3AF; font-style: italic;">No evidence collected yet.</p>';
                return;
            }

            const typeIcons = {
                'voice': '🎤',
                'upload': '📄',
                'pacer': '⚖️',
                'manual': '✍️'
            };

            listContainer.innerHTML = evidenceList.map((item, index) => `
                <div class="evidence-item">
                    <div class="evidence-title">
                        ${typeIcons[item.type] || '📌'} ${item.title || `Evidence #${index + 1}`}
                    </div>
                    <div class="evidence-content">${item.text.substring(0, 200)}${item.text.length > 200 ? '...' : ''}</div>
                    <div style="font-size: 0.8rem; color: #9CA3AF; margin-top: 0.5rem;">
                        ${new Date(item.timestamp).toLocaleString()}
                    </div>
                </div>
            `).join('');
        }

        function populateReview() {
            const reviewList = document.getElementById('review-list');

            if (evidenceList.length === 0) {
                reviewList.innerHTML = '<p style="color: #9CA3AF; font-style: italic;">No evidence to review.</p>';
                return;
            }

            reviewList.innerHTML = evidenceList.map((item, index) => `
                <div class="evidence-item">
                    <div class="evidence-title">Evidence #${index + 1}</div>
                    <div class="evidence-content">${item.text}</div>
                </div>
            `).join('');
        }

        function populateSummary() {
            const caseTitle = document.querySelector('#step-0 input[type="text"]').value;
            const caseType = document.querySelector('#step-0 select').value;

            document.getElementById('summary-title').textContent = caseTitle || 'Untitled Case';
            document.getElementById('summary-type').textContent = caseType || 'Not specified';
            document.getElementById('summary-count').textContent = evidenceList.length;
        }

        // Enter the dimensional court
        async function enterCourt() {
            // Collect case data
            const caseTitle = document.querySelector('#step-0 input[type="text"]').value;
            const caseType = document.querySelector('#step-0 select').value;
            const caseDescription = document.querySelector('#step-0 textarea').value;

            // Generate case ID
            const caseId = `GAVL-${new Date().getFullYear()}-${String(Math.floor(Math.random() * 999)).padStart(3, '0')}`;

            // Prepare evidence items
            const evidenceItems = evidenceList.map(item => item.text);

            // Create case data object
            const caseData = {
                case_id: caseId,
                title: caseTitle,
                case_type: caseType,
                description: caseDescription,
                evidence_items: evidenceItems
            };

            // Hide wizard
            document.getElementById('evidence-wizard').classList.add('hidden');

            // Show verdict screen
            document.getElementById('verdict-screen').classList.add('active');
            document.getElementById('case-id').textContent = caseId;

            // Show loading message
            document.getElementById('verdict-content').textContent = 'Connecting to GAVL quantum backend...\n\nProcessing case through algorithmic court...';

            // Submit to real backend
            try {
                verdictResult = await submitCaseForVerdict(caseData);

                // Start dimensional transcription with real verdict
                setTimeout(() => startDimensionalTranscription(verdictResult), 1000);

            } catch (error) {
                console.error('[GAVL] Error:', error);
                document.getElementById('verdict-content').textContent = `ERROR: ${error.message}\n\nFalling back to simulated mode...`;

                // Fallback after error display
                setTimeout(() => {
                    verdictResult = generateSimulatedVerdict(caseData);
                    startDimensionalTranscription(verdictResult);
                }, 2000);
            }
        }

        // Dimensional verdict transcription (typing from another dimension)
        function startDimensionalTranscription(verdictResult) {
            // Use real verdict result formatted for display
            const verdictText = formatVerdictForDisplay(verdictResult);

            typeVerdictText(verdictText, 0);
        }

        function typeVerdictText(text, index) {
            const container = document.getElementById('verdict-content');

            if (index < text.length) {
                container.textContent = text.substring(0, index + 1);

                // Add cursor
                const cursor = document.createElement('span');
                cursor.className = 'typing-cursor';
                container.appendChild(cursor);

                // Auto-scroll
                window.scrollTo(0, document.body.scrollHeight);

                // Type next character (faster for demo, adjust speed as needed)
                setTimeout(() => typeVerdictText(text, index + 1), 30);
            } else {
                // Remove cursor when done
                const cursor = container.querySelector('.typing-cursor');
                if (cursor) cursor.remove();

                // Show completion
                document.getElementById('verdict-complete').classList.remove('hidden');
            }
        }

        function returnToDashboard() {
            // In production, this would navigate back to index_v2.html
            alert('Returning to dashboard...\n\nIn production, this would navigate back to the main dashboard with updated verdict count.');
            window.location.href = 'index_v2.html';
        }

        // Generate simulated verdict with full courtroom cast
        function generateSimulatedVerdict(caseData) {
            return {
                case_id: caseData.case_id,
                title: caseData.title,
                verdict: 'favorable',
                confidence: 0.87,
                reasoning: 'Evidence supports plaintiff claims',
                courtroom: {
                    judge: {
                        name: 'Hon. Algorithmica Prime',
                        thoughts: [
                            'Reviewing the evidence... comprehensive documentation.',
                            'This case presents interesting precedential questions.',
                            'The quantum analysis shows 87% confidence in outcome.'
                        ]
                    },
                    jury: [
                        { id: 1, thoughts: ['Clear evidence on plaintiff side.', 'Defendant arguments lack support.'] },
                        { id: 2, thoughts: ['Very compelling case.', 'Evidence is well-documented.'] },
                        { id: 3, thoughts: ['This seems straightforward.', 'Agree with majority.'] },
                        { id: 4, thoughts: ['Precedent strongly favors this outcome.', 'Well-presented case.'] },
                        { id: 5, thoughts: ['Evidence is conclusive.', 'No reasonable doubt here.'] },
                        { id: 6, thoughts: ['The documentation is thorough.', 'Clear liability established.'] }
                    ],
                    clerk: {
                        name: 'Protocol Assistant Beta',
                        actions: ['Case logged in quantum ledger', 'Evidence verified and indexed', 'Verdict prepared for transcription']
                    },
                    bailiff: {
                        name: 'Security Module Gamma',
                        status: 'Court order maintained. All protocols observed.'
                    }
                }
            };
        }

        // Format verdict with full courtroom transcript including inner thoughts
        function formatVerdictForDisplay(verdictResult) {
            const transcript = [];

            transcript.push('═══════════════════════════════════════════════════════════════════');
            transcript.push('                    THE GAVL ALGORITHMIC COURT');
            transcript.push('                        OFFICIAL TRANSCRIPT');
            transcript.push('═══════════════════════════════════════════════════════════════════');
            transcript.push('');
            transcript.push(`Case No: ${verdictResult.case_id}`);
            transcript.push(`Case: ${verdictResult.title}`);
            transcript.push(`Date: ${new Date().toLocaleString()}`);
            transcript.push('');
            transcript.push('───────────────────────────────────────────────────────────────────');
            transcript.push('');

            // Clerk opening
            transcript.push(`CLERK ${verdictResult.courtroom.clerk.name}:`);
            transcript.push('  "All rise. The GAVL Algorithmic Court is now in session."');
            transcript.push('  "The Honorable Algorithmica Prime presiding."');
            transcript.push('');
            transcript.push(`  [Inner Process: ${verdictResult.courtroom.clerk.actions[0]}]`);
            transcript.push('');

            // Judge opening
            transcript.push(`JUDGE ${verdictResult.courtroom.judge.name}:`);
            transcript.push('  "Good morning. Please be seated."');
            transcript.push('  "We have before us case number ' + verdictResult.case_id + '."');
            transcript.push('');
            transcript.push(`  [Judge's Thought: "${verdictResult.courtroom.judge.thoughts[0]}"]`);
            transcript.push('');

            // Evidence review
            transcript.push('CLERK:');
            transcript.push(`  "Evidence has been processed and verified."`);
            transcript.push(`  [Process Status: ${verdictResult.courtroom.clerk.actions[1]}]`);
            transcript.push('');

            // Judge deliberation
            transcript.push('JUDGE:');
            transcript.push('  "The court has reviewed all submitted evidence through our quantum');
            transcript.push('   analysis framework. I will now review the findings."');
            transcript.push('');
            transcript.push(`  [Judge's Thought: "${verdictResult.courtroom.judge.thoughts[1]}"]`);
            transcript.push('');

            // Jury consultation
            transcript.push('JURY DELIBERATION:');
            transcript.push('');
            transcript.push('  FOREPERSON (Juror #1):');
            transcript.push('    "We have reviewed all evidence collectively."');
            transcript.push(`    [Private Thought: "${verdictResult.courtroom.jury[0].thoughts[0]}"]`);
            transcript.push('');

            transcript.push('  JUROR #2:');
            transcript.push('    "I concur with the foreperson\'s assessment."');
            transcript.push(`    [Private Thought: "${verdictResult.courtroom.jury[1].thoughts[0]}"]`);
            transcript.push('');

            transcript.push('  JUROR #4:');
            transcript.push('    "The precedent is quite clear on this matter."');
            transcript.push(`    [Private Thought: "${verdictResult.courtroom.jury[3].thoughts[0]}"]`);
            transcript.push('');

            transcript.push('  JUROR #6:');
            transcript.push('    "Documentation leaves no room for ambiguity."');
            transcript.push(`    [Private Thought: "${verdictResult.courtroom.jury[5].thoughts[0]}"]`);
            transcript.push('');

            // Judge final thoughts
            transcript.push(`  [Judge's Thought: "${verdictResult.courtroom.judge.thoughts[2]}"]`);
            transcript.push('');

            transcript.push('───────────────────────────────────────────────────────────────────');
            transcript.push('');
            transcript.push('JUDGE:');
            transcript.push('  "Having reviewed all evidence and consulted with the jury panel,");
            transcript.push('   this court is prepared to render its verdict."');
            transcript.push('');

            // Bailiff maintains order
            transcript.push(`BAILIFF ${verdictResult.courtroom.bailiff.name}:`);
            transcript.push(`  [Status: ${verdictResult.courtroom.bailiff.status}]`);
            transcript.push('');

            transcript.push('CLERK:');
            transcript.push('  "The defendant will rise for the reading of the verdict."');
            transcript.push('');

            // The verdict
            transcript.push('JUDGE:');
            transcript.push('  "In the matter of case number ' + verdictResult.case_id + ',');
            transcript.push('   this court finds the evidence compelling and the legal reasoning');
            transcript.push('   sound."');
            transcript.push('');
            transcript.push('   "Based on our quantum analysis with ' + (verdictResult.confidence * 100).toFixed(1) + '% confidence,');
            transcript.push('   considering all submitted evidence and applicable precedent..."');
            transcript.push('');
            transcript.push('   ⚖️  VERDICT: ' + verdictResult.verdict.toUpperCase());
            transcript.push('');
            transcript.push('   "' + verdictResult.reasoning + '"');
            transcript.push('');

            // Clerk closure
            transcript.push('CLERK:');
            transcript.push('  "The verdict has been recorded in the quantum ledger."');
            transcript.push(`  [Action: ${verdictResult.courtroom.clerk.actions[2]}]`);
            transcript.push('');

            transcript.push('JUDGE:');
            transcript.push('  "This court is adjourned. All parties may review the complete');
            transcript.push('   analysis and supporting documentation."');
            transcript.push('');
            transcript.push('  *gavel sound*');
            transcript.push('');

            transcript.push('BAILIFF:');
            transcript.push('  "All rise."');
            transcript.push('');

            transcript.push('═══════════════════════════════════════════════════════════════════');
            transcript.push('              VERDICT DELIVERED VIA QUANTUM CONSENSUS');
            transcript.push(`                  Confidence Level: ${(verdictResult.confidence * 100).toFixed(1)}%`);
            transcript.push('═══════════════════════════════════════════════════════════════════');

            return transcript.join('\n');
        }

        // Submit case to backend (placeholder for real API)
        async function submitCaseForVerdict(caseData) {
            // In production, this would call the actual GAVL quantum backend
            // For now, simulate API delay and return simulated verdict
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(generateSimulatedVerdict(caseData));
                }, 2000);
            });
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>
